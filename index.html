<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>ğŸ€ Cute Secure Messenger</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" href="icon.png" type="image/png">
    <script src="https://unpkg.com/openpgp@5.11.2/dist/openpgp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script src="pwa-impl.js"></script>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ğŸ€ Cute Secure Messenger</h1>
        <p>Whisper secrets with your friends ğŸ’–</p>
      </header>

      <div class="key-status">
        <span id="keyStatus">âœ¨ Loading your keys...</span>
        <div class="key-actions">
          <button id="exportKeyBtn" class="btn-secondary">
            ğŸ“¥ Export My Key
          </button>
          <button id="importKeyBtn" class="btn-secondary">
            ğŸ“¤ Import Friend's Key
          </button>
          <button id="linkPhoneBtn" class="btn-primary">ğŸ“± Link Phone</button>
          <button id="resetKeyBtn" class="btn-danger">ğŸ”„ Reset My Keys</button>
        </div>
      </div>

      <div class="tabs">
        <button class="tab-btn active" data-tab="encrypt">
          ğŸ’Œ Send Message
        </button>
        <button class="tab-btn" data-tab="decrypt">ğŸ“© Receive Message</button>
        <button class="tab-btn" data-tab="stego">ğŸ–¼ï¸ Stego Images</button>
        <button class="tab-btn" data-tab="vault">ğŸ“‚ File Vault</button>
        <button class="tab-btn" data-tab="pgp">ğŸ” PGP</button>
        <button class="tab-btn" data-tab="contacts">ğŸ‘¥ Friends</button>
        <button class="tab-btn" data-tab="settings">âš™ï¸ Settings</button>
      </div>

      <div class="tab-content">
        <!-- Encrypt Tab -->
        <div id="encrypt-tab" class="tab-pane active">
          <div class="input-group">
            <label for="recipientSelect">ğŸ‘©â€â¤ï¸â€ğŸ‘¨ Send to Friends:</label>
            <div class="recipient-selection">
              <select
                id="recipientSelect"
                class="contact-select"
                multiple
                size="4"
              >
                <!-- Options will be populated by JS -->
              </select>
              <div class="selection-info">
                Hold Ctrl/Cmd to select multiple friends
              </div>
            </div>
          </div>

          <div class="input-group">
            <label for="encryptInput">ğŸ’Œ Your Secret Message:</label>
            <textarea
              id="encryptInput"
              placeholder="Type your secret message here... ğŸ’­"
            ></textarea>
          </div>

          <div class="actions">
            <button id="encryptBtn" class="btn-primary">
              âœ¨ Send Securely
            </button>
            <button id="saveEncryptBtn" class="btn-secondary">
              ğŸ’¾ Save All
            </button>
            <button id="copyAllBtn" class="btn-secondary">
              ğŸ“‹ Copy All Messages
            </button>
          </div>

          <div class="result">
            <label>ğŸ”’ Encrypted Messages:</label>
            <div id="multiEncryptResults" class="multi-results">
              <p class="no-results">
                Encrypt a message to see results here... ğŸ”
              </p>
            </div>
          </div>
        </div>

        <!-- Decrypt Tab -->
        <div id="decrypt-tab" class="tab-pane">
          <div class="input-group">
            <label for="decryptInput">ğŸ“© Encrypted Message:</label>
            <textarea
              id="decryptInput"
              placeholder="Paste the encrypted message here... ğŸ”"
            ></textarea>
          </div>

          <div class="actions">
            <button id="decryptBtn" class="btn-primary">
              ğŸ’« Decrypt Message
            </button>
            <button id="copyDecryptBtn" class="btn-secondary">
              ğŸ“‹ Copy Result
            </button>
          </div>

          <div class="result decrypt-result">
            <label>ğŸ’Œ Decrypted Message:</label>
            <textarea
              id="decryptOutput"
              placeholder="Your decrypted message will appear here... ğŸ’–"
            ></textarea>
          </div>
        </div>

        <!-- Steganography Tab -->
        <div id="stego-tab" class="tab-pane">
          <div class="stego-mode-toggle">
            <button class="stego-mode-btn active" data-stego-mode="encode">ğŸ”® Hide Image</button>
            <button class="stego-mode-btn" data-stego-mode="decode">ğŸ” Reveal Image</button>
          </div>

          <!-- Encode Section -->
          <div id="stego-encode" class="stego-section active">
            <div class="stego-info-banner">
              <span class="stego-info-icon">ğŸ€</span>
              <div>
                <strong>Hide a secret image inside a decoy!</strong>
                <p>The output looks like the decoy, but contains your secret image hidden in the pixels. A tiny ğŸ€ watermark is added so your friend knows to check it.</p>
              </div>
            </div>

            <div class="stego-upload-grid">
              <div class="stego-upload-card" id="decoyUploadCard">
                <div class="stego-upload-label">ğŸ–¼ï¸ Decoy Image</div>
                <div class="stego-upload-sublabel">What people will see</div>
                <div class="stego-upload-zone" id="decoyDropZone">
                  <input type="file" id="decoyImageInput" accept="image/png,image/jpeg,image/webp" hidden />
                  <div class="stego-upload-placeholder" id="decoyPlaceholder">
                    <span class="stego-upload-icon">ğŸ“·</span>
                    <span>Click or drag to upload</span>
                  </div>
                  <img id="decoyPreview" class="stego-preview-img" style="display:none" />
                </div>
                <div class="stego-img-info" id="decoyInfo"></div>
              </div>

              <div class="stego-upload-arrow">â•</div>

              <div class="stego-upload-card" id="secretUploadCard">
                <div class="stego-upload-label">ğŸ¤« Secret Image</div>
                <div class="stego-upload-sublabel">What you want to hide</div>
                <div class="stego-upload-zone" id="secretDropZone">
                  <input type="file" id="secretImageInput" accept="image/png,image/jpeg,image/webp" hidden />
                  <div class="stego-upload-placeholder" id="secretPlaceholder">
                    <span class="stego-upload-icon">ğŸ¤</span>
                    <span>Click or drag to upload</span>
                  </div>
                  <img id="secretPreview" class="stego-preview-img" style="display:none" />
                </div>
                <div class="stego-img-info" id="secretInfo"></div>
              </div>
            </div>

            <div class="input-group" style="margin-bottom: 15px;">
              <label for="stegoRecipientSelect">ğŸ”’ Encrypt for:</label>
              <select id="stegoRecipientSelect" class="contact-select" multiple size="3">
                <option value="__PUBLIC__">ğŸŒ Anyone (Public Stego)</option>
                <option value="__SELF__" selected>ğŸ”’ Me (For Myself)</option>
              </select>
              <div style="font-size: 0.78em; color: #9B59B6; margin-top: 4px; font-style: italic;">Hold Ctrl/Cmd for multiple recipients. Select "Anyone" for unencrypted transport.</div>
            </div>

            <div class="stego-capacity-bar" id="stegoCapacityBar" style="display:none">
              <div class="stego-capacity-label">
                <span>ğŸ“Š Capacity</span>
                <span id="stegoCapacityText">0%</span>
              </div>
              <div class="stego-capacity-track">
                <div class="stego-capacity-fill" id="stegoCapacityFill"></div>
              </div>
              <div class="stego-capacity-detail" id="stegoCapacityDetail"></div>
            </div>

            <div class="stego-actions">
              <button id="stegoEncodeBtn" class="btn-primary stego-btn" disabled>
                ğŸ”® Hide Image Inside Decoy
              </button>
            </div>

            <div class="stego-progress" id="stegoEncodeProgress" style="display:none">
              <div class="stego-progress-bar">
                <div class="stego-progress-fill" id="stegoEncodeProgressFill"></div>
              </div>
              <div class="stego-progress-text" id="stegoEncodeProgressText">Processing...</div>
            </div>

            <div class="stego-result" id="stegoEncodeResult" style="display:none">
              <div class="stego-result-header">
                <span>âœ¨ Stego Image Ready!</span>
                <div class="stego-result-actions">
                  <button id="stegoDownloadBtn" class="btn-primary btn-small">ğŸ’¾ Save Image</button>
                  <button id="stegoCopyBtn" class="btn-secondary btn-small">ğŸ“‹ Copy to Clipboard</button>
                </div>
              </div>
              <div class="stego-result-preview">
                <canvas id="stegoOutputCanvas"></canvas>
              </div>
              <div class="stego-result-note">
                ğŸ€ Look for the tiny ribbon in the bottom-right corner â€” that's how your friend knows to decode it!
              </div>
            </div>
          </div>

          <!-- Decode Section -->
          <div id="stego-decode" class="stego-section">
            <div class="stego-info-banner decode">
              <span class="stego-info-icon">ğŸ”</span>
              <div>
                <strong>Extract a hidden image!</strong>
                <p>Upload a stego image (look for the ğŸ€ watermark in the corner) to reveal the secret image hidden inside.</p>
              </div>
            </div>

            <div class="stego-upload-card full-width">
              <div class="stego-upload-label">ğŸ–¼ï¸ Stego Image</div>
              <div class="stego-upload-sublabel">Image with a hidden secret inside</div>
              <div class="stego-upload-zone" id="stegoDecodeDropZone">
                <input type="file" id="stegoDecodeInput" accept="image/png,image/jpeg,image/webp" hidden />
                <div class="stego-upload-placeholder" id="stegoDecodePlaceholder">
                  <span class="stego-upload-icon">ğŸ”</span>
                  <span>Click or drag to upload stego image</span>
                </div>
                <img id="stegoDecodePreview" class="stego-preview-img" style="display:none" />
              </div>
            </div>

            <div class="stego-actions">
              <button id="stegoDecodeBtn" class="btn-primary stego-btn" disabled>
                ğŸ” Reveal Hidden Image
              </button>
            </div>

            <div class="stego-progress" id="stegoDecodeProgress" style="display:none">
              <div class="stego-progress-bar">
                <div class="stego-progress-fill" id="stegoDecodeProgressFill"></div>
              </div>
              <div class="stego-progress-text" id="stegoDecodeProgressText">Extracting...</div>
            </div>

            <div class="stego-result" id="stegoDecodeResult" style="display:none">
              <div class="stego-result-header">
                <span>ğŸ¤« Secret Image Revealed!</span>
                <div class="stego-result-actions">
                  <button id="stegoDecodeDownloadBtn" class="btn-primary btn-small">ğŸ’¾ Save Secret</button>
                  <button id="stegoDecodeCopyBtn" class="btn-secondary btn-small">ğŸ“‹ Copy to Clipboard</button>
                </div>
              </div>
              <div class="stego-result-preview">
                <canvas id="stegoDecodeOutputCanvas"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- File Vault Tab -->
        <div id="vault-tab" class="tab-pane">
          <div class="stego-info-banner">
            <span class="stego-info-icon">ğŸ“‚</span>
            <div>
              <strong>Secure File Vault</strong>
              <p>Encrypt any file for yourself or friends. Decrypt files securely.</p>
            </div>
          </div>
          
          <div class="vault-container">
            <div class="vault-drop-zone" id="vaultDropZone">
                <input type="file" id="vaultFileInput" hidden />
                <div class="vault-placeholder">
                    <span class="vault-icon">ğŸ“„</span>
                    <span>Drag & Drop File to Encrypt/Decrypt</span>
                    <button id="vaultSelectBtn" class="btn-secondary btn-small">Select File</button>
                    <div id="vaultFileInfo" style="margin-top: 10px; font-weight: bold; display: none;"></div>
                </div>
            </div>
            
            <div id="vaultEncryptOptions" style="display: none; margin-top: 20px;">
                <label>ğŸ”’ Encrypt For:</label>
                <select id="vaultRecipientSelect" class="contact-select" multiple size="4">
                    <!-- Populated by JS -->
                </select>
                <div class="actions" style="margin-top: 15px;">
                    <button id="vaultEncryptBtn" class="btn-primary">ğŸ”’ Encrypt File</button>
                </div>
            </div>
            
            <div id="vaultDecryptOptions" style="display: none; margin-top: 20px;">
                <div class="actions">
                    <button id="vaultDecryptBtn" class="btn-primary">ğŸ”“ Decrypt File</button>
                </div>
            </div>
            
            <div id="vaultResult" class="result" style="display: none; margin-top: 20px;">
                <div id="vaultResultText"></div>
                <button id="vaultOpenFolderBtn" class="btn-secondary btn-small">ğŸ“‚ Open Folder</button>
            </div>

          </div>
        </div>

        <!-- PGP Tab -->
        <div id="pgp-tab" class="tab-pane">
          <div class="pgp-layout">
             <div class="pgp-sidebar">
                <h3>Keyring ğŸ”‘</h3>
                <div id="pgpKeyList" class="pgp-key-list"></div>
                <button id="pgpNewKeyBtn" class="btn-primary btn-small" style="width: 100%; margin-top: 10px;">â• New Key Pair</button>
             </div>
             
             <div class="pgp-main">
                <div class="pgp-section">
                    <h3>ğŸ“ PGP Message</h3>
                    <textarea id="pgpInput" placeholder="Type message or paste PGP block..."></textarea>
                    
                    <div class="pgp-controls">
                        <div class="pgp-recipients">
                           <label>To:</label>
                           <select id="pgpRecipientSelect" multiple></select>
                        </div>
                        <div class="pgp-actions">
                           <button id="pgpEncryptBtn" class="btn-primary">ğŸ”’ Encrypt</button>
                           <button id="pgpSignBtn" class="btn-secondary">âœï¸ Sign</button>
                           <button id="pgpDecryptBtn" class="btn-action">ğŸ”“ Decrypt</button>
                        </div>
                    </div>
                </div>
                
                <div class="pgp-section result" id="pgpResultSection" style="display:none">
                    <h3>ğŸ“„ Result</h3>
                    <textarea id="pgpOutput" readonly></textarea>
                    <button id="pgpCopyBtn" class="btn-secondary btn-small">ğŸ“‹ Copy</button>
                </div>
             </div>
          </div>
          
          <!-- PGP Key Gen Modal -->
          <div id="pgpGenModal" class="modal">
             <div class="modal-content">
                <span class="close" id="closePgpGen">&times;</span>
                <h3>Generate PGP Key</h3>
                <input type="text" id="pgpGenName" placeholder="Full Name" />
                <input type="email" id="pgpGenEmail" placeholder="Email Address" />
                <input type="password" id="pgpGenPass" placeholder="Passphrase (Optional but recommended)" />
                <button id="pgpGenerateActionBtn" class="btn-primary">Generate Key ğŸ”‘</button>
             </div>
          </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-pane">
            <h2>âš™ï¸ Application Settings</h2>
            
            <div class="setting-item">
                <label>ğŸŒ— Theme</label>
                <button id="toggleThemeBtn" class="btn-secondary">Switch to Dark Mode ğŸŒ™</button>
            </div>
            
            <div class="setting-item">
                <label>ğŸ¨ Accent Color</label>
                <div class="color-options">
                    <button class="color-btn active" data-color="pink" style="background: #ff69b4;">ğŸ€ Pink</button>
                    <button class="color-btn" data-color="blue" style="background: #5dade2;">ğŸ¦‹ Blue</button>
                    <button class="color-btn" data-color="mint" style="background: #58d68d;">ğŸŒ¿ Mint</button>
                    <button class="color-btn" data-color="lavender" style="background: #af7ac5;">ğŸ”® Lavender</button>
                    <button class="color-btn" data-color="peach" style="background: #ffb347;">ğŸ‘ Peach</button>
                    <button class="color-btn" data-color="gold" style="background: #f1c40f;">âœ¨ Gold</button>
                    <button class="color-btn" data-color="teal" style="background: #1abc9c;">ğŸ’ Teal</button>
                    <button class="color-btn" data-color="gray" style="background: #95a5a6;">ğŸŒªï¸ Gray</button>
                    <button class="color-btn" data-color="cherry" style="background: #e74c3c;">ğŸ’ Cherry</button>
                    <button class="color-btn" data-color="coffee" style="background: #a0522d;">â˜• Coffee</button>
                    <button class="color-btn" data-color="ocean" style="background: #2980b9;">ğŸŒŠ Ocean</button>
                    <button class="color-btn" data-color="forest" style="background: #27ae60;">ğŸŒ² Forest</button>
                </div>
            </div>

            <div class="setting-item">
                <label>ğŸ“ Layout Mode</label>
                <div class="layout-options" style="display:flex; gap:10px;">
                    <button class="layout-btn active" data-layout="default">Default</button>
                    <button class="layout-btn" data-layout="compact">Compact</button>
                    <button class="layout-btn" data-layout="pro">Professional</button>
                </div>
            </div>

            <div class="setting-item">
                <label>ğŸ”¡ Font Size</label>
                <div class="font-options">
                    <button class="font-btn" data-size="small">Small</button>
                    <button class="font-btn active" data-size="medium">Medium</button>
                    <button class="font-btn" data-size="large">Large</button>
                </div>
            </div>

            <div class="setting-item">
                <label>âš™ï¸ Behavior</label>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                     <span style="color: #666; font-size: 0.9em;">Auto-Copy Decrypted Text</span>
                     <label class="toggle-switch">
                         <input type="checkbox" id="autoCopyToggle">
                         <span class="toggle-slider"></span>
                     </label>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                     <span style="color: #666; font-size: 0.9em;">Auto-Read Clipboard</span>
                     <label class="toggle-switch">
                         <input type="checkbox" id="autoReadToggle">
                         <span class="toggle-slider"></span>
                     </label>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                     <span style="color: #666; font-size: 0.9em;">Enable Animations</span>
                     <label class="toggle-switch">
                         <input type="checkbox" id="animationsToggle" checked>
                         <span class="toggle-slider"></span>
                     </label>
                </div>
            </div>

            <div class="setting-item">
                <label>ğŸ”Š Sound Effects</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="soundToggle" checked>
                    <span class="toggle-slider"></span>
                    <span style="margin-left: 10px; font-size: 0.9em; color: #666;">Play cute sounds on send/receive</span>
                </label>
            </div>

            <div class="setting-item">
                <label>ğŸ”’ Privacy Lock</label>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span style="color: #666; font-size: 0.9em;">Auto-Lock on Idle</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoLockToggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div id="autoLockTimeContainer" style="display:none; margin-left: 0px; align-items: center;">
                    <label style="font-size: 0.9em; display: inline-block; margin-right: 10px; margin-bottom: 0;">Lock after:</label>
                    <select id="autoLockTimeSelect" class="contact-select" style="width: auto; padding: 5px; height: auto;">
                        <option value="1">1 Minute</option>
                        <option value="5" selected>5 Minutes</option>
                        <option value="15">15 Minutes</option>
                        <option value="30">30 Minutes</option>
                    </select>
                </div>
            </div>

            
            <div class="setting-item">
                <label>ğŸ”’ Privacy Lock</label>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span style="color: #666; font-size: 0.9em;">Auto-Lock on Idle</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoLockToggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div id="autoLockTimeContainer" style="display:none; margin-left: 0px; align-items: center;">
                    <label style="font-size: 0.9em; display: inline-block; margin-right: 10px; margin-bottom: 0;">Lock after:</label>
                    <select id="autoLockTimeSelect" class="contact-select" style="width: auto; padding: 5px; height: auto;">
                        <option value="1">1 Minute</option>
                        <option value="5" selected>5 Minutes</option>
                        <option value="15">15 Minutes</option>
                        <option value="30">30 Minutes</option>
                    </select>
                </div>
            </div>
            
            <div class="setting-item">
                <label>ğŸ” Security</label>
                <p>Manage your application security settings.</p>
                <button id="resetAppBtn" class="btn-danger">âš ï¸ Reset Application (Clear All Data)</button>
            </div>
             
        </div>

        <!-- Contacts Tab -->
        <div id="contacts-tab" class="tab-pane">
          <div class="input-group">
            <label for="newContactName">ğŸ‘©â€â¤ï¸â€ğŸ‘¨ Add New Friend:</label>
            <div class="add-contact-form">
              <input
                type="text"
                id="newContactName"
                placeholder="Enter friend's name..."
              />
              <input
                type="text"
                id="newContactKey"
                placeholder="Paste their key (encrypted or public)..."
              />
              <button id="addContactFormBtn" class="btn-primary">
                â• Add Friend
              </button>
            </div>
          </div>

          <div class="input-group">
            <label>ğŸ”‘ Your Public Key (Share this with friends):</label>
            <div class="key-display">
              <textarea id="myPublicKey" readonly></textarea>
              <button id="copyKeyBtn" class="btn-secondary">ğŸ“‹ Copy Key</button>
              <button id="exportPublicKeyBtn" class="btn-secondary">
                ğŸ“¤ Export Public Key
              </button>
            </div>
            <div class="security-note">
              âš ï¸ <strong>Security Options:</strong>
              You can share your public key directly (easy but less secure) or
              export it encrypted (secure but requires password exchange).
            </div>
          </div>

          <div class="contacts-list">
            <h3>ğŸ‘­ Your Friends List:</h3>
            <div id="contactsContainer" class="contacts-container">
              <p class="no-contacts">
                No friends added yet! Add your first friend above ğŸ’•
              </p>
            </div>
          </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-pane">
            <h2>âš™ï¸ Application Settings</h2>
            
            <div class="setting-item">
                <label>ğŸŒ— Theme</label>
                <button id="toggleThemeBtn" class="btn-secondary">Switch to Dark Mode ğŸŒ™</button>
            </div>
            
            <div class="setting-item">
                <label>ğŸ¨ Accent Color</label>
                <div class="color-options">
                    <button class="color-btn active" data-color="pink" style="background: #ff69b4;">ğŸ€ Pink</button>
                    <button class="color-btn" data-color="blue" style="background: #5dade2;">ğŸ¦‹ Blue</button>
                    <button class="color-btn" data-color="mint" style="background: #58d68d;">ğŸŒ¿ Mint</button>
                    <button class="color-btn" data-color="lavender" style="background: #af7ac5;">ğŸ”® Lavender</button>
                    <button class="color-btn" data-color="peach" style="background: #ffb347;">ğŸ‘ Peach</button>
                    <button class="color-btn" data-color="gold" style="background: #f1c40f;">âœ¨ Gold</button>
                    <button class="color-btn" data-color="teal" style="background: #1abc9c;">ğŸ’ Teal</button>
                    <button class="color-btn" data-color="gray" style="background: #95a5a6;">ğŸŒªï¸ Gray</button>
                    <button class="color-btn" data-color="cherry" style="background: #e74c3c;">ğŸ’ Cherry</button>
                    <button class="color-btn" data-color="coffee" style="background: #a0522d;">â˜• Coffee</button>
                    <button class="color-btn" data-color="ocean" style="background: #2980b9;">ğŸŒŠ Ocean</button>
                    <button class="color-btn" data-color="forest" style="background: #27ae60;">ğŸŒ² Forest</button>
                    <button class="color-btn" data-color="sunset" style="background: #ff6b35;">ğŸŒ… Sunset</button>
                    <button class="color-btn" data-color="grape" style="background: #7d3c98;">ğŸ‡ Grape</button>
                    <button class="color-btn" data-color="rose" style="background: #e91e63;">ğŸŒ¹ Rose</button>
                    <button class="color-btn" data-color="neon" style="background: #00e676;">ğŸ’š Neon</button>
                    <button class="color-btn" data-color="ice" style="background: #42a5f5;">â„ï¸ Ice</button>
                    <button class="color-btn" data-color="coral" style="background: #ff7043;">ğŸª¸ Coral</button>
                    <button class="color-btn" data-color="candy" style="background: #ec407a;">ğŸ¬ Candy</button>
                    <button class="color-btn" data-color="midnight" style="background: #1a237e;">ğŸŒŒ Midnight</button>
                </div>
            </div>

            <div class="setting-item">
                <label>ğŸ“ Layout Mode</label>
                <div class="layout-options" style="display:flex; gap:10px;">
                    <button class="layout-btn active" data-layout="default">Default</button>
                    <button class="layout-btn" data-layout="compact">Compact</button>
                    <button class="layout-btn" data-layout="pro">Professional</button>
                </div>
            </div>

            <div class="setting-item">
                <label>ğŸ”¡ Font Size</label>
                <div class="font-options">
                    <button class="font-btn" data-size="small">Small</button>
                    <button class="font-btn active" data-size="medium">Medium</button>
                    <button class="font-btn" data-size="large">Large</button>
                </div>
            </div>

            <div class="setting-item">
                <label>ğŸ”Š Sound Effects</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="soundToggle" checked>
                    <span class="toggle-slider"></span>
                    <span style="margin-left: 10px; font-size: 0.9em; color: #666;">Play cute sounds on send/receive</span>
                </label>
            </div>
            
            <div class="setting-item">
                <label>ğŸ” Security</label>
                <p>Manage your application security settings.</p>
                <button id="resetAppBtn" class="btn-danger">âš ï¸ Reset Application (Clear All Data)</button>
            </div> 
        </div>
      </div>

      <!-- Export Key Modal -->
      <div id="exportModal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <h2>ğŸ“¥ Export Your Key Securely</h2>
          <p>Choose how to share your key with friends</p>

          <div class="export-options">
            <div class="export-option">
              <h3>ğŸ”’ Encrypted Key Export (Recommended)</h3>
              <p>
                <strong>Pros:</strong> Maximum security, only verified friends
                can import with password
              </p>
              <p>
                <strong>Cons:</strong> Requires password exchange, more complex
              </p>
              <div class="input-group">
                <label for="exportPassword">ğŸ”’ Password for encryption:</label>
                <input
                  type="password"
                  id="exportPassword"
                  placeholder="Enter a strong password..."
                />
              </div>
              <div class="input-group">
                <label for="exportConfirmPassword">ğŸ”’ Confirm Password:</label>
                <input
                  type="password"
                  id="exportConfirmPassword"
                  placeholder="Confirm your password..."
                />
              </div>


              <button id="exportEncryptedKeyBtn" class="btn-primary">
                ğŸ’¾ Export Encrypted Key File
              </button>
            </div>

            <div class="export-option">
              <h3>ğŸ“¤ Simple Public Key Export</h3>
              <p><strong>Pros:</strong> Easy to share, no password needed</p>
              <p>
                <strong>Cons:</strong> Less secure, anyone with the file can add
                you as contact
              </p>
              <button id="exportSimpleKeyBtn" class="btn-secondary">
                ğŸ“„ Export Public Key File
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Link Phone Modal -->
      <div id="linkPhoneModal" class="modal">
          <div class="modal-content" style="max-width: 500px;">
              <span class="close" id="closeLinkPhone">&times;</span>
              <h2 style="text-align: center;">ğŸ“± Link Your Phone</h2>
              <p style="text-align: center;">Scan this code with the <strong>Cute Secure Mobile App</strong> to securely sync your keys and contacts.</p>
              
              <div class="qr-container" style="text-align: center; margin: 20px 0; min-height: 200px; display: flex; align-items: center; justify-content: center; background: #fafafa; border-radius: 10px;">
                  <img id="linkQrCode" src="" alt="QR Code" style="width: 250px; height: 250px; display: none;">
                  <div id="qrLoading">Generating secure code... ğŸ”</div>
              </div>
              
              <div class="security-warning" style="background: #fff5f7; padding: 15px; border-radius: 10px; border: 1px solid #ffb6c1; text-align: center;">
                   <p style="margin: 0 0 10px 0;"><strong>ğŸ”’ ONE-TIME PASSWORD</strong></p>
                   <div id="linkOtp" style="font-family: monospace; font-size: 2em; letter-spacing: 5px; font-weight: bold; color: #ff69b4; background: white; padding: 10px; border-radius: 5px; display: inline-block;">LOADING</div>
                   <p style="margin: 10px 0 0 0; font-size: 0.9em; color: #d63384;">Enter this code on your phone to decrypt your keys. This ensures your key remains internal and secure during transfer.</p>
              </div>
              </div>

              <!-- Manual Copy Section (Source) -->
              <div id="manualCopySection" style="margin-top: 20px; display: none;">
                  <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">
                  <p style="text-align: center; color: #666; font-size: 0.9em;">Linking on the same device? Copy this code:</p>
                  <textarea id="linkTransferData" readonly style="width: 100%; height: 60px; font-size: 0.8em; color: #888; border: 1px solid #ddd; border-radius: 5px; padding: 5px; resize: none; margin-bottom: 5px;"></textarea>
                  <button id="copyLinkCodeBtn" class="btn-secondary" style="width: 100%; font-size: 0.9em;">ğŸ“‹ Copy Code to Clipboard</button>
              </div>

              <!-- Manual Entry Toggle (Target) -->
              <div style="margin-top: 20px; text-align: center;">
                  <a href="#" id="toggleManualLink" style="color: #ff69b4; text-decoration: underline; font-size: 0.9em;">Linking FROM another device? Click here to enter code.</a>
              </div>

              <!-- Manual Entry Form (Target) -->
              <div id="manualLinkSection" style="display: none; margin-top: 15px; border-top: 1px solid #ffb6c1; padding-top: 15px;">
                  <h3 style="text-align: center; color: #d63384;">ğŸ”— Link From Code</h3>
                  <p style="font-size: 0.8em; text-align: center; color: #666;">Paste the code from your other device below.</p>
                  
                  <textarea id="manualLinkInput" placeholder="Paste the long code here..." style="width: 100%; height: 80px; border: 1px solid #ffb6c1; border-radius: 5px; padding: 8px; margin-bottom: 10px; resize: vertical;"></textarea>
                  
                  <div style="display: flex; gap: 10px; align-items: center;">
                      <input type="text" id="manualLinkOtp" placeholder="OTP (6 digits)" maxlength="6" style="flex: 1; padding: 10px; border: 1px solid #ffb6c1; border-radius: 5px; text-align: center; letter-spacing: 2px;">
                      <button id="confirmLinkBtn" class="btn-primary" style="flex: 2;">ğŸ”— Link Device</button>
                  </div>
              </div>
          </div>
      </div>

      <!-- Import Key Modal -->
      <div id="importModal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <h2>ğŸ“¤ Import Friend's Key</h2>
          <p>Choose how to add a friend's key</p>

          <div class="import-options">
            <div class="import-option">
              <h3>ğŸ”’ Encrypted Key Import (Recommended)</h3>
              <p>
                <strong>Pros:</strong> Maximum security, verifies identity
                through password
              </p>
              <p>
                <strong>Cons:</strong> Requires password from friend, more
                complex
              </p>
              <div class="input-group">
                <label for="importContactName">ğŸ‘©â€â¤ï¸â€ğŸ‘¨ Friend's Name:</label>
                <input
                  type="text"
                  id="importContactName"
                  placeholder="Enter the name you want to use for this friend..."
                />
              </div>
              <div class="input-group">
                <label for="importPassword">ğŸ”’ Password to decrypt:</label>
                <input
                  type="password"
                  id="importPassword"
                  placeholder="Enter password from your friend..."
                />
              </div>
              <div class="input-group">
                <label>
                  <input type="checkbox" id="importVerifiedCheckbox" /> âœ… Mark
                  as Verified Friend
                </label>
                <p class="verification-info">
                  Verified friends can be restricted for enhanced security
                </p>
              </div>
              <button id="loadEncryptedKeyBtn" class="btn-primary">
                ğŸ“‚ Load Encrypted Key File
              </button>
            </div>

            <div class="import-option">
              <h3>ğŸ“„ Simple Public Key Import</h3>
              <p><strong>Pros:</strong> Easy to use, no password needed</p>
              <p>
                <strong>Cons:</strong> Less secure, anyone can add you as
                contact
              </p>
              <div class="input-group">
                <label for="importSimpleContactName">ğŸ‘©â€â¤ï¸â€ğŸ‘¨ Friend's Name:</label>
                <input
                  type="text"
                  id="importSimpleContactName"
                  placeholder="Enter the name you want to use for this friend..."
                />
              </div>
              <div class="input-group">
                <label>
                  <input type="checkbox" id="importSimpleVerifiedCheckbox" /> âœ…
                  Mark as Verified Friend
                </label>
                <p class="verification-info">
                  Verified friends can be restricted for enhanced security
                </p>
              </div>
              <button id="loadSimpleKeyBtn" class="btn-secondary">
                ğŸ“‚ Load Public Key File
              </button>
            </div>
          </div>

          <div id="importStatus" class="import-status"></div>
        </div>
      </div>

      <div id="message" class="message"></div>
    </div>

    <!-- Lock Screen Overlay -->
    <div id="lockScreen" class="lock-screen" style="display:none;">
      <div class="lock-icon">ğŸ”’</div>
      <div class="lock-title">App Locked</div>
      <div class="lock-message">Safe and sound while you were away! ğŸ’–</div>
      <button id="unlockBtn" class="unlock-btn">âœ¨ Unlock</button>
    </div>

    <script src="renderer.js"></script>
  </body>
</html>
